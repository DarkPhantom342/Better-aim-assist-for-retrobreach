local v0 = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))();

local aimAssistWindow = _G.FluentAimAssistWindow;

local excludedUsernames = {};
local usernameInputBox = nil;

if aimAssistWindow then
    local mainTab = aimAssistWindow:FindTabByTitle("Main")

    if mainTab then
        local exclusionSection = mainTab:AddSection("Blacklist");

        usernameInputBox = exclusionSection:AddInput("UsernameInput", {
            Title = "Username Blacklist",
            Placeholder = "Enter username...",
            Default = "",
            Callback = function(value)
            end
        });

        exclusionSection:AddButton("AddUsernameButton", {
            Title = "Add to Blacklist",
            Callback = function()
                local username = usernameInputBox.Value;
                if username and username ~= "" then
                    local lowerCaseUsername = string.lower(username);
                    if not table.find(excludedUsernames, lowerCaseUsername) then
                        table.insert(excludedUsernames, lowerCaseUsername);
                        aimAssistWindow:Notify({Title = "Blacklist", Content = username .. " added.", Duration = 3});
                        usernameInputBox:SetValue("");
                    else
                        aimAssistWindow:Notify({Title = "Blacklist", Content = username .. " is already in the list.", Duration = 3});
                    end
                end
            end
        });

        exclusionSection:AddButton("RemoveUsernameButton", {
            Title = "Remove from Blacklist",
            Callback = function()
                local username = usernameInputBox.Value;
                if username and username ~= "" then
                    local lowerCaseUsername = string.lower(username);
                    local foundIndex = nil;
                    for i, v in ipairs(excludedUsernames) do
                        if v == lowerCaseUsername then
                            foundIndex = i;
                            break;
                        end
                    end
                    if foundIndex then
                        table.remove(excludedUsernames, foundIndex);
                        aimAssistWindow:Notify({Title = "Blacklist", Content = username .. " removed.", Duration = 3});
                        usernameInputBox:SetValue("");
                    else
                        aimAssistWindow:Notify({Title = "Blacklist", Content = username .. " not found in the list.", Duration = 3});
                    end
                end
            end
        });
    end
end

_G.findBestTarget = function()
    local bestTargetPart = nil;
    local minFovDistance = _G.v10;
    local screenCenter = Vector2.new(_G.v4.ViewportSize.X / 2, _G.v4.ViewportSize.Y / 2);

    local foundationTeamNames = {"Mobile Task Forces", "Foundation Personnel", "Security Department"};
    local counterforcesTeamNames = {"Class-D", "Chaos Insurgency"};
    local anomaliesTeamNames = {"Serpent's Hand", "SCP"};
    local gocTeamNames = {"Global Occult Coalition"};

    local currentFoundationCount = 0
    local currentCounterforcesCount = 0
    local currentAnomaliesCount = 0
    local currentGOCCount = 0

    local localPlayerTeamName = _G.v5.Team and _G.v5.Team.Name or "";
    local localPlayerTeamGroup = _G.getTeamGroup(localPlayerTeamName);


    for _, targetPlayer in ipairs(_G.v1:GetPlayers()) do
        if ((targetPlayer ~= _G.v5) and targetPlayer.Character and targetPlayer.Character:FindFirstChild(_G.v12)) then
            local targetTeamName = targetPlayer.Team and targetPlayer.Team.Name or "";
            local targetTeamGroup = _G.getTeamGroup(targetTeamName);
            local targetPlayerName = string.lower(targetPlayer.Name);

            if table.find(excludedUsernames, targetPlayerName) then
                continue;
            end

            local targetHumanoid = targetPlayer.Character:FindFirstChildOfClass("Humanoid");
            local isAlive = targetHumanoid and (targetHumanoid.Health > 0);

            if isAlive then
                if targetTeamGroup == "Foundation" then
                    currentFoundationCount = currentFoundationCount + 1
                elseif targetTeamGroup == "Counter-forces" then
                    currentCounterforcesCount = currentCounterforcesCount + 1
                elseif targetTeamGroup == "Anomalies" then
                    currentAnomaliesCount = currentAnomaliesCount + 1
                elseif targetTeamGroup == "GOC" then
                    currentGOCCount = currentGOCCount + 1
                end
            end

            if localPlayerTeamGroup and targetTeamGroup and (localPlayerTeamGroup == targetTeamGroup) then
                continue;
            end

            if _G.v13 and (targetTeamName == localPlayerTeamName) then
                continue;
            end

            if (_G.disableForFoundation and targetTeamGroup == "Foundation") then
                continue;
            end
            if (_G.disableForCounterforces and targetTeamGroup == "Counter-forces") then
                continue;
            end
            if (_G.disableForAnomalies and targetTeamGroup == "Anomalies") then
                continue;
            end
            if (_G.disableForGOC and targetTeamGroup == "GOC") then
                continue;
            end

            if targetTeamName == "SCP" then
                if not _G.playerHasItems(targetPlayer) then
                    continue;
                end
            end

            if (_G.v14 and (not isAlive)) then
                continue;
            end

            local targetPart = targetPlayer.Character[_G.v12];
            if not targetPart then
                 continue;
            end

            local worldToViewportPoint, isOnScreen = _G.v4:WorldToViewportPoint(targetPart.Position);

            if isOnScreen then
                if _G.v48 and not _G.hasLineOfSight(_G.v4, targetPart) then
                    continue
                end
                
                local targetScreenPosition = Vector2.new(worldToViewportPoint.X, worldToViewportPoint.Y);
                local fovDistance = (targetScreenPosition - screenCenter).Magnitude;

                if (fovDistance < minFovDistance) then
                    minFovDistance = fovDistance;
                    bestTargetPart = targetPart;
                end
            end
        end
    end

    local currentScreenGui = _G.v5.PlayerGui:FindFirstChild("PlayerCounterDisplay")
    if currentScreenGui then
        local labelFoundation = currentScreenGui:FindFirstChild("FoundationCount")
        if labelFoundation then labelFoundation.Text = tostring(currentFoundationCount) end

        local labelCounterforces = currentScreenGui:FindFirstChild("CounterforcesCount")
        if labelCounterforces then labelCounterforces.Text = tostring(currentCounterforcesCount) end

        local labelAnomalies = currentScreenGui:FindFirstChild("AnomaliesCount")
        if labelAnomalies then labelAnomalies.Text = tostring(currentAnomaliesCount) end

        local labelGOC = currentScreenGui:FindFirstChild("GOCCount")
        if labelGOC then labelGOC.Text = tostring(currentGOCCount) end
    end
    return bestTargetPart;
end;
